<!doctype html>
<html lang='en'>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="icon" href="https://i.postimg.cc/wv2Mnn2m/logo-1-3x-100.jpg" />
    <title>Order History ‚Äî Deenice Finds</title>
    <link rel='stylesheet' href='css/styles.css' />
    <style>
        /* Order History Specific Styles */
        .order-history-page {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .page-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .page-header h1 {
            color: var(--primary-text, #0b1420);
            margin-bottom: 10px;
        }

        .page-header p {
            color: var(--muted, #9aa4b2);
            font-size: 1.1rem;
        }

        .order-card {
            background: var(--glass-bg, rgba(255, 255, 255, 0.6));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(142, 219, 209, 0.2);
            border-radius: var(--radius, 14px);
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: var(--card-shadow, 0 6px 18px rgba(15, 20, 30, 0.06));
            transition: all 0.3s ease;
        }

        .order-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(142, 219, 209, 0.15);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(142, 219, 209, 0.2);
        }

        .order-info h3 {
            margin: 0 0 8px 0;
            color: var(--primary-text, #0b1420);
        }

        .order-meta {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .order-meta span {
            font-size: 0.9rem;
            color: var(--muted, #9aa4b2);
        }

        .order-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-completed {
            background: rgba(34, 197, 94, 0.1);
            color: #16a34a;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .status-pending {
            background: rgba(234, 179, 8, 0.1);
            color: #ca8a04;
            border: 1px solid rgba(234, 179, 8, 0.3);
        }

        .status-processing {
            background: rgba(59, 130, 246, 0.1);
            color: #2563eb;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .status-cancelled {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .order-items {
            margin-bottom: 20px;
        }

        .order-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .order-item:last-child {
            border-bottom: none;
        }

        .item-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
            flex-shrink: 0;
        }

        .item-details {
            flex: 1;
        }

        .item-details h4 {
            margin: 0 0 5px 0;
            color: var(--primary-text, #0b1420);
            font-size: 0.95rem;
        }

        .item-specs {
            font-size: 0.8rem;
            color: var(--muted, #9aa4b2);
            margin-bottom: 5px;
        }

        .item-price {
            font-weight: 600;
            color: var(--primary-text, #0b1420);
        }

        .order-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 15px;
            border-top: 1px solid rgba(142, 219, 209, 0.2);
        }

        .order-total {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary-text, #0b1420);
        }

        .order-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #8EDBD1, rgba(142, 219, 209, 0.3));
            color: var(--primary-text, #0b1420);
            border: 1px solid rgba(142, 219, 209, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(142, 219, 209, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.6);
            color: var(--muted, #9aa4b2);
            border: 1px solid rgba(142, 219, 209, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(142, 219, 209, 0.1);
            color: var(--primary-text, #0b1420);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--muted, #9aa4b2);
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: var(--primary-text, #0b1420);
        }

        .empty-state p {
            margin-bottom: 20px;
        }

        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(142, 219, 209, 0.2);
            border-radius: 20px;
            color: var(--muted, #9aa4b2);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
        }

        .filter-btn.active {
            background: #8EDBD1;
            color: var(--primary-text, #0b1420);
            border-color: #8EDBD1;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #8EDBD1;
            text-decoration: none;
            margin-bottom: 20px;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .back-link:hover {
            color: #7BC9BF;
        }

        @media (max-width: 768px) {
            .order-history-page {
                padding: 16px;
            }

            .order-header {
                flex-direction: column;
                gap: 10px;
            }

            .order-meta {
                gap: 10px;
            }

            .order-footer {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .order-actions {
                width: 100%;
                justify-content: space-between;
            }

            .btn {
                flex: 1;
                text-align: center;
            }

            .filters {
                justify-content: center;
            }
        }
    </style>
</head>
<body class="order-history-page">
    <a href="index.html" class="back-link">‚Üê Back to Home</a>
    
    <div class="page-header">
        <h1>üì¶ Your Order History</h1>
        <p>Track and manage your past orders</p>
    </div>

    <div class="filters">
        <button class="filter-btn active" data-filter="all">All Orders</button>
        <button class="filter-btn" data-filter="completed">Completed</button>
        <button class="filter-btn" data-filter="pending">Pending</button>
        <button class="filter-btn" data-filter="processing">Processing</button>
    </div>

    <div id="orders-container">
        <!-- Orders will be loaded here -->
    </div>
    <script>
// Ensure order sync is initialized on order history page
document.addEventListener('DOMContentLoaded', function() {
    // Force initialize order sync if not already done
    if (!window.orderSync) {
        console.log('üîÑ Manually initializing OrderSyncManager...');
        window.orderSync = new OrderSyncManager();
    }
    
    // Add real-time update listener directly to order history
    if (typeof orderHistory !== 'undefined') {
        // Listen for admin updates
        window.addEventListener('adminOrderUpdate', function(e) {
            console.log('üì¢ Direct admin update received in order history:', e.detail);
            orderHistory.loadOrders().then(() => orderHistory.renderOrders());
        });
        
        // Listen for storage changes
        window.addEventListener('storage', function(e) {
            if (e.key === 'de_order_history') {
                console.log('üíæ Storage change detected in order history');
                orderHistory.loadOrders().then(() => orderHistory.renderOrders());
            }
        });
    }
    
    // Test function for debugging
    window.testOrderUpdate = function(orderId, newStatus) {
        const event = new CustomEvent('adminOrderUpdate', {
            detail: {
                orderId: orderId,
                newStatus: newStatus,
                timestamp: new Date().toISOString()
            }
        });
        window.dispatchEvent(event);
        alert(`Test update sent: ${orderId} -> ${newStatus}`);
    };
});
</script>
    <script src="js/order-history.js"></script>
    <script src="js/order-sync.js"></script>
    <!-- Permanent Order Storage -->
<script src="js/order-storage.js"></script>
<script src="js/order-history.js"></script>

<script>
// Emergency recovery on page load
document.addEventListener('DOMContentLoaded', function() {
    // Check if orders are missing and attempt recovery
    setTimeout(() => {
        const orders = orderHistory.orders;
        if (!orders || orders.length === 0) {
            console.log('üîÑ No orders found, attempting auto-recovery...');
            orderHistory.emergencyRecovery();
        }
        
        // Debug info
        console.log('üìä Order Storage Status:', orderStorage.getStorageStats());
    }, 2000);
});

// Global debug function
window.debugOrderStorage = function() {
    const stats = orderStorage.getStorageStats();
    const info = `
üîç ORDER STORAGE DEBUG:

üì¶ Orders in Memory: ${orderHistory.orders.length}
üíæ Primary Storage: ${stats.ordersInPrimary}
üîÑ Backup Storage: ${stats.ordersInBackup}
üìä Storage Size: ${Math.round(stats.storageSize / 1024)} KB
üïí Last Backup: ${new Date(stats.lastBackup).toLocaleTimeString()}

üõ†Ô∏è Commands:
‚Ä¢ orderHistory.manualRefresh() - Force refresh
‚Ä¢ orderHistory.emergencyRecovery() - Emergency recovery
‚Ä¢ orderStorage.clearAllData() - Clear all data (careful!)
    `.trim();
    
    console.log(info);
    alert(info);
};
</script>
</body>
</html>
